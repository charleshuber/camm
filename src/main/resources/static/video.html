<html>
<head>
</head>
<body>
	<canvas id="thePlaceToBe" style="display:block; margin: auto"></canvas>
</body>
<script>
	var canvas = document.querySelector("#thePlaceToBe");
	var ctx = canvas.getContext('2d');
	var img = new Image();
	
	var flip = false;
	
	img.onload = function(){
		if(!flip){
			canvas.height = this.height;
			canvas.width = this.width;
			ctx.translate(640, 0);
			ctx.scale(-1, 1);
			flip = true;
		}
		ctx.drawImage(img, 0, 0, 640, 480, 0, 0, 640, 480);
	};
	img.onerror = function(e){
		console.log('Error during loading image:', e);
	};
	var image = document.querySelector("#image");
	
	var loc = window.location, new_uri;
	if (loc.protocol === "https:") {
		new_uri = "wss:";
	} else {
		new_uri = "ws:";
	}
	new_uri += "//" + loc.host + "/stream";


	var exampleSocket = new WebSocket(new_uri);
	
	exampleSocket.onopen = function(event) {
		exampleSocket.send("data");
	};

	exampleSocket.onmessage = function(event) {
		if (!isString(event.data)) {
			handleData(event.data);
		}
	}

	function handleData(blob) {
		var urlCreator = window.URL || window.webkitURL;
		var imageUrl = urlCreator.createObjectURL(blob);
		img.src = imageUrl;	
	}

	function isString(s) {
		return typeof (s) === 'string' || s instanceof String;
	}
	
	window.onbeforeunload = closingCode;
	function closingCode(){
		exampleSocket.send("close");
	}
</script>
</html>